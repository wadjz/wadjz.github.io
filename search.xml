<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>1-RocketMQ-安装</title>
      <link href="/2023/03/17/1-%E5%88%86%E5%B8%83%E5%BC%8F-MQ-RocketMQ-%E5%AE%89%E8%A3%85/"/>
      <url>/2023/03/17/1-%E5%88%86%E5%B8%83%E5%BC%8F-MQ-RocketMQ-%E5%AE%89%E8%A3%85/</url>
      
        <content type="html"><![CDATA[<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><blockquote><p>我们使用 4.9.1版本</p></blockquote><p>下载地址：<a href="https://github.com/apache/rocketmq/releases%E3%80%82">https://github.com/apache/rocketmq/releases。</a></p><p>官网：<a href="https://rocketmq.apache.org/">https://rocketmq.apache.org/</a></p><p>RocketMQ由以下这几个组件组成：</p><ul><li>NameServer : 提供Broker路由服务</li><li>Broker：实际处理消息存储、转发等服务的核心组件</li><li>Producer：消息生产者(集群)</li><li>Consumer：消息消费者(集群)</li></ul><blockquote><p>我们要启动RocketMQ服务，需要先启动NameServer。</p></blockquote><p>我们先约定：</p><ul><li>这里我们用docker安装</li><li>namesrv、broker、rockermq-console 我们装在一同机器上</li><li>这里我们用 192.168.56.4 这台机器</li></ul><h2 id="namesrv安装"><a href="#namesrv安装" class="headerlink" title="namesrv安装"></a>namesrv安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 拉取镜像</span></span></span><br><span class="line">docker pull apache/rocketmq:4.9.1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 创建namesrv数据存储路径</span></span></span><br><span class="line">mkdir -p /opt/docker/rocketmq/data/namesrv/logs</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建namesrv容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">--restart=always \</span><br><span class="line">--name rmqnamesrv \</span><br><span class="line">-p 9876:9876 \</span><br><span class="line">-v /opt/docker/rocketmq/data/namesrv/logs:/home/rocketmq/logs \</span><br><span class="line">-e &quot;JAVA_OPT_EXT=-server -Xms64m -Xmx64m -Xmn32m&quot; \</span><br><span class="line">apache/rocketmq:4.9.1 \</span><br><span class="line">sh mqnamesrv</span><br></pre></td></tr></table></figure><h2 id="broker安装"><a href="#broker安装" class="headerlink" title="broker安装"></a>broker安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建broker数据存储路径</span></span><br><span class="line">mkdir -p /opt/docker/rocketmq/data/broker/logs  /opt/docker/rocketmq/data/broker/store  /opt/docker/rocketmq/conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建配置文件</span></span><br><span class="line">vi /opt/docker/rocketmq/conf/broker.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">设置权限</span></span><br><span class="line">chmod 777 /opt/docker/rocketmq/data/broker/logs</span><br><span class="line">chmod 777 /opt/docker/rocketmq/data/broker/store</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建broker容器</span></span><br><span class="line">docker run -d  \</span><br><span class="line">--restart=always \</span><br><span class="line">--name rmqbroker \</span><br><span class="line">--link rmqnamesrv:namesrv \</span><br><span class="line">-p 10911:10911 \</span><br><span class="line">-p 10909:10909 \</span><br><span class="line">-v /opt/docker/rocketmq/data/broker/logs:/home/rocketmq/logs \</span><br><span class="line">-v /opt/docker/rocketmq/data/broker/store:/home/rocketmq/store \</span><br><span class="line">-v /opt/docker/rocketmq/conf/broker.conf:/home/rocketmq/rocketmq-4.9.1/conf/broker.conf \</span><br><span class="line">-e &quot;NAMESRV_ADDR=namesrv:9876&quot; \</span><br><span class="line">-e &quot;JAVA_OPT_EXT=-server -Xms256m -Xmx256m -Xmn128m&quot; \</span><br><span class="line">apache/rocketmq:4.9.1 \</span><br><span class="line">sh mqbroker -c /home/rocketmq/rocketmq-4.9.1/conf/broker.conf</span><br></pre></td></tr></table></figure><p><code>broker.conf</code> 内容如下：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 所属集群名称，如果节点较多可以配置多个</span></span><br><span class="line"><span class="attr">brokerClusterName</span> = <span class="string">DefaultCluster</span></span><br><span class="line"><span class="comment">#broker名称，master和slave使用相同的名称，表明他们的主从关系</span></span><br><span class="line"><span class="attr">brokerName</span> = <span class="string">broker-a</span></span><br><span class="line"><span class="comment">#0表示Master，大于0表示不同的slave</span></span><br><span class="line"><span class="attr">brokerId</span> = <span class="string">0</span></span><br><span class="line"><span class="comment">#表示几点做消息删除动作，默认是凌晨4点</span></span><br><span class="line"><span class="attr">deleteWhen</span> = <span class="string">04</span></span><br><span class="line"><span class="comment">#在磁盘上保留消息的时长，单位是小时</span></span><br><span class="line"><span class="attr">fileReservedTime</span> = <span class="string">48</span></span><br><span class="line"><span class="comment">#有三个值：SYNC_MASTER，ASYNC_MASTER，SLAVE；同步和异步表示Master和Slave之间同步数据的机制；</span></span><br><span class="line"><span class="attr">brokerRole</span> = <span class="string">ASYNC_MASTER</span></span><br><span class="line"><span class="comment">#刷盘策略，取值为：ASYNC_FLUSH，SYNC_FLUSH表示同步刷盘和异步刷盘；SYNC_FLUSH消息写入磁盘后才返回成功状态，ASYNC_FLUSH不需要；</span></span><br><span class="line"><span class="attr">flushDiskType</span> = <span class="string">ASYNC_FLUSH</span></span><br><span class="line"><span class="comment"># 设置broker节点所在服务器的ip地址</span></span><br><span class="line"><span class="attr">brokerIP1</span> = <span class="string">192.168.56.4</span></span><br><span class="line"><span class="comment"># 磁盘使用达到95%之后,生产者再写入消息会报错 CODE: 14 DESC: service not available now, maybe disk full</span></span><br><span class="line"><span class="attr">diskMaxUsedSpaceRatio</span>=<span class="string">95</span></span><br></pre></td></tr></table></figure><h2 id="rockermq-console-安装"><a href="#rockermq-console-安装" class="headerlink" title="rockermq-console 安装"></a>rockermq-console 安装</h2><blockquote><p>管控台</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 拉取镜像</span></span></span><br><span class="line">docker pull pangliang/rocketmq-console-ng</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># 构建rockermq-console容器</span></span></span><br><span class="line">docker run -d \</span><br><span class="line">--restart=always \</span><br><span class="line">--name rmqadmin \</span><br><span class="line">-e &quot;JAVA_OPTS=-Drocketmq.namesrv.addr=192.168.56.4:9876 \</span><br><span class="line">-Dcom.rocketmq.sendMessageWithVIPChannel=false&quot; \</span><br><span class="line">-p 9999:8080 \</span><br><span class="line">pangliang/rocketmq-console-ng</span><br></pre></td></tr></table></figure><p>访问：<a href="http://192.168.56.4:9999/">http://192.168.56.4:9999</a></p><p><img src="image-20230317215244034.png" alt="image-20230317215244034"></p><h2 id="RocketMQ的几个名词"><a href="#RocketMQ的几个名词" class="headerlink" title="RocketMQ的几个名词"></a>RocketMQ的几个名词</h2><p><img src="image-20230317223010070.png" alt="image-20230317223010070"></p><p>RocketMQ主要由 Producer、Broker、Consumer 三部分组成：</p><ul><li>Producer：负责生产消息</li><li>Consumer：负责消费消息</li><li>Broker：负责存储消息</li></ul><p>Broker 在实际部署过程中对应服务器，每个 Broker 可以存储多个Topic 的消息，每个Topic 的消息也可以分片存储于不同的 Broker。</p><p>Message Queue 用于存储消息的物理地址，每个Topic中的消息地址存储于多个 Message Queue 中。ConsumerGroup 由多个Consumer 实例构成。</p>]]></content>
      
      
      <categories>
          
          <category> RocketMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RocketMQ </tag>
            
            <tag> MQ </tag>
            
            <tag> 分布式 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
